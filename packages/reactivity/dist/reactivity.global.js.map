{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export {reactive} from './reactive'\nexport {effect} from './effect'\n// isObject\n", "export const isObject = (value) => {\n    return typeof value === 'object' && value !== null\n}", "export let activeEffect = undefined\n\nfunction clearnupEffect(effect) {\n    const { deps } = effect\n    // deeps = []\n    for (let i = 0; i < deps.length; i++) {\n        deps[i].delete(effect)\n    }\n    deps.length = 0\n\n}\nclass ReactiveEffect {\n    active = true\n    parent = null\n    deps = [] //effect\u4F9D\u8D56\u7684\u5C5E\u6027\u6240\u62E5\u6709\u7684effect\n    constructor(public fn) { }\n    run() {\n        if (!this.active) { return this.fn() }\n\n        try {\n            this.parent = activeEffect\n            activeEffect = this\n            clearnupEffect(this)\n            return this.fn()\n        } finally {\n            activeEffect = this.parent\n            this.parent = null\n        }\n    }\n    stop() {\n        this.active = false\n        clearnupEffect(this)\n    }\n}\n\nexport function effect(fn) {\n    const _effect = new ReactiveEffect(fn)\n\n    _effect.run()\n\n    const runner = _effect.run.bind(_effect)\n    runner.effect = _effect\n\n    return runner\n}\n\nconst targetMap = new WeakMap()\nexport function track(target, type, key) {\n    if (!activeEffect) return\n\n    let depsMap = targetMap.get(target)\n    if (!depsMap) {\n        targetMap.set(target, (depsMap = new Map()))\n    }\n\n    let dep = depsMap.get(key)\n    if (!dep) {\n        depsMap.set(key, (dep = new Set()))\n    }\n\n    let shouldTrack = !dep.has(activeEffect)\n    if (shouldTrack) {\n        dep.add(activeEffect)\n        //dep \u662F\u5C5E\u6027\u5BF9\u5E94\u7684set\n        activeEffect.deps.push(dep)\n    }\n\n\n}\n\nexport function trigger(target, type, key, newValue, oldValue) {\n    const depsMap = targetMap.get(target)\n    if (!depsMap) return\n    let effects = depsMap.get(key)\n    if (effects) {\n        effects = [...effects]\n        effects?.forEach(effect => {\n            if (activeEffect !== effect) {\n                effect.run()\n            }\n        });\n    }\n\n}", "import { activeEffect, track, trigger } from \"./effect\"\nexport const enum ReactiveFlags {\n    IS_REACTIVE = '__v_isReactive'\n}\nexport const mutableHandlers = {\n    get(target, key, receiver) {\n        if (key === ReactiveFlags.IS_REACTIVE) {\n            return true\n        }\n\n        track(target, 'get', key)\n        return Reflect.get(target, key, receiver)\n    },\n    set(target, key, value, receiver) {\n        // target[key] = value\n        debugger\n        let oldValue = target[key]\n        let result = Reflect.set(target, key, value, receiver)\n        if (oldValue !== value) {\n            trigger(target, 'set', key, value, oldValue)\n        }\n        return result\n    },\n\n}", "import { isObject } from \"@vue/shared\";\nimport { mutableHandlers, ReactiveFlags } from \"./baseHandler\";\n\n\nconst reactiveMap = new WeakMap()\n\nexport function reactive(target) {\n    if (!isObject(target)) {\n        return\n    }\n    if (target[ReactiveFlags.IS_REACTIVE]) {\n        return target\n    }\n    let existingProxy = reactiveMap.get(target)\n    if (existingProxy) {\n        return existingProxy\n    }\n    const proxy = new Proxy(target, mutableHandlers)\n    reactiveMap.set(target, proxy)\n\n    return proxy\n}\n"],
  "mappings": "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",
  "names": []
}
